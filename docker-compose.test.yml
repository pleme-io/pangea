services:
  test:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/app:cached  # Mount code for live editing
      - bundler_cache:/usr/local/bundle  # Persist gems
    working_dir: /app
    command: bundle exec rspec
    environment:
      - RUBYOPT=-W0  # Suppress warnings for cleaner output
      - BUNDLE_PATH=/usr/local/bundle

  shell:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/app:cached
      - bundler_cache:/usr/local/bundle
    working_dir: /app
    command: /bin/bash
    stdin_open: true
    tty: true
    environment:
      - RUBYOPT=-W0
      - BUNDLE_PATH=/usr/local/bundle

volumes:
  bundler_cache: